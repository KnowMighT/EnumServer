# MJRefresh

å·²ç»å¾ˆä¹…æ²¡æœ‰å†™æŠ€æœ¯æ–‡ç« äº†ï¼Œä¹‹å‰ä¸€æ®µæ—¶é—´ç¡®å®ä¹Ÿæ˜¯å¾ˆå¿™ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå€Ÿå£ï¼Œè‡ªå·±ä¸æ€è¿›å–çš„æˆåˆ†ä¹Ÿæœ‰ä¸å°‘ã€‚ ä¸è¿‡è¿™æ®µæ—¶é—´ç¡®å®ä¹Ÿå¾—åˆ°äº†å¾ˆå¤šçš„é”»ç‚¼ï¼Œæœ‰äº›ä¸œè¥¿ä¹Ÿæ²¡æ³•ç›´æ¥ç”¨è¯­è¨€è¡¨è¾¾ï¼Œæˆ–è®¸ï¼Œæœ€å¤§çš„æ”¶è·åœ¨äºæˆ‘æ¸æ¸çš„æ²‰ä¸‹å¿ƒæ¥äº†ï¼Œä¸å†æƒ§æ€•é‚£ä¹ˆå¤šè¡Œä»£ç äº†ï¼Œæ›´äº†è§£å†™ç¨‹åºè¿™å›äº‹äº†ã€‚ğŸ˜‚


å…³äº`MJRefresh`ä¹‹å‰ä¹Ÿæƒ³ç ”ç©¶çš„ï¼Œä½†æ˜¯å¥ˆä½•èƒ½åŠ›ä¸å¤Ÿï¼Œä»£ç çœ‹ä¸è¿›å»ã€‚ç°åœ¨åšçš„ä¸œè¥¿å¤šäº†ï¼ŒçŸ¥é“è¦åšå‡ºä¸€ä¸ªèƒ½é€šç”¨äºæ•´ä¸ªé¡¹ç›®ä¹ƒè‡³å¼€æºç»™å¾ˆå¤šç”¨æˆ·çš„æ§ä»¶æ˜¯éœ€è¦ä¸€ç‚¹ç‚¹çš„å»æ­å»ºå’Œä¼˜åŒ–çš„ï¼Œæ‰€ä»¥åˆ°äº†ä¸€å®šç¨‹åº¦ï¼Œæ§ä»¶æ˜¯ä¼šå¤§åˆ°ä¸€å®šé‡çº§çš„ï¼Œçœ‹ä¸ä¸‹å»çœ‹ä¸æ‡‚ä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„ï¼Œå› ä¸ºå¾ˆå¤šä»£ç ç¡®å®ä¸çŸ¥é“ä½œè€…æ˜¯ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™çš„ã€‚


åˆ°ç°åœ¨å†™ç¨‹åºä¸¤å¹´äº†ï¼Œæˆ‘å¹¶æ²¡æœ‰è‡ªå·±æˆ–è€…è¯´å‚ä¸è¿‡çš„å¼€æºé¡¹ç›®ã€‚é¡¶å¤šä¹Ÿå°±æ˜¯åœ¨å…¬å¸é‡Œå†™ä¸€äº›é¡¹ç›®ä¸­ç”¨çš„åˆ°çš„æ§ä»¶ï¼Œæ›´å¤šçš„ç²¾åŠ›ç”¨åœ¨å†™ä¸šåŠ¡é€»è¾‘ï¼Œå› ä¸ºå…¬å¸æ˜¯åšå»ºç­‘è¡Œä¸šååŒè½¯ä»¶çš„ï¼Œè¦æŠŠå»ºç­‘è¡Œä¸šé‚£ä¸€å¥—ç¹ççš„çº¿ä¸‹ä¸œè¥¿åšæˆçº¿ä¸Šåº”ç”¨ã€‚æ§ä»¶å†™å¤šäº†ï¼Œç”¨æ˜¯èƒ½ç”¨ï¼Œä½†æ˜¯çœŸçš„å†™åˆ°ä½äº†å—ï¼Œèƒ½å¤Ÿç»å¾—èµ·å¤§é‡ç”¨æˆ·çš„ä½¿ç”¨å—ï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚

å¸¦ç€è¿™æ ·ä¸€ä»½ç–‘æƒ‘ï¼Œæˆ‘å›è¿‡å¤´æ¥æƒ³æƒ³è‡ªå·±èƒ½å¦å†æ¬¡å»çœ‹ä¸€äº›å¼€æºé¡¹ç›®äº†ï¼Œèƒ½å¦å¥½å¥½å»ä½“ä¼šä¸€ä¸ªæ§ä»¶è¯¥æ€ä¹ˆå†™äº†ï¼Œè¿˜æœ‰æ²¡æœ‰å“ªäº›æˆ‘æ²¡æœ‰è€ƒè™‘åˆ°çš„ä¸œè¥¿ã€‚æ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘å†³å®šå†™ä¸€ä¸‹ MJRefresh çš„è§£è¯»å’Œç†è§£ï¼Œå®ƒå¾ˆå¸¸ç”¨ï¼Œæˆ‘ç°åœ¨åšè¿‡çš„é¡¹ç›®éƒ½æ˜¯ç”¨çš„å®ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªæ§ä»¶ï¼Œæ²¡æœ‰å¤ªå¤šé«˜å¤§ä¸Šçš„ç†è®ºï¼Œæˆ‘å¯¹å®ƒçš„ç†è§£æ˜¯æœ´å®å¯é ã€‚ä½†æˆ‘ä¹Ÿä¸è®¤ä¸ºæˆ‘èƒ½åœ¨çŸ­æ—¶é—´å†…å°±ç†è§£é€å®ƒï¼Œæˆ‘å·²ç»åšå¥½äº†ä¸€ç‚¹ç‚¹å¡«å‘çš„å‡†å¤‡äº†ï¼Œæ‰“æŒä¹…æˆ˜ã€‚

å” å¨äº†å¾ˆå¤šï¼Œå…¶å®ç®—æ˜¯è®²ç»™è‡ªå·±å¬çš„ï¼Œåˆ›å»ºä¸€ä»½ä»ªå¼æ„Ÿï¼Œç»™è‡ªå·±æ ‘ç«‹ç‚¹ä¿¡å¿ƒã€‚åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥æ­£æ–‡ã€‚


## MJRefreshComponent

`MJRefresh`ä¸­çš„åŸºç±»ï¼Œé‡Œé¢æŠ½è±¡äº†å­ç±»å…±ç”¨çš„æ–¹æ³•, æœ‰äº›æ–¹æ³•æ˜¯ä¾›å­ç±»è°ƒç”¨çš„ï¼Œå¦‚ï¼š

```
- (void)beginRefreshing;
- (void)beginRefreshingWithCompletionBlock:(void (^)(void))completionBlock;
```

æœ‰äº›æ–¹æ³•æ˜¯ä¾›å­ç±»å¤å†™çš„ï¼Œå¦‚ï¼š

```
- (void)prepare;
- (void)placeSubviews;
```

`MJRefresh`ç»§æ‰¿é“¾ä¸Šçš„ç±»è¾ƒå¤šï¼Œå±‚çº§æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æŸ¥çœ‹æ‰§è¡Œé¡ºåºçš„æ—¶å€™è¿˜æ˜¯æ¯”è¾ƒåƒåŠ›çš„ã€‚ä½†æ˜¯åªè¦ææ¸…æ¥šæ¯ä¸€å±‚çš„ç±»çš„ä½œç”¨ä»¥åŠ`UIView`é‚£äº›é’©å­æ–¹æ³•çš„æ‰§è¡Œå…ˆåé¡ºåºï¼Œå¯ä»¥ä¸ºç†è§£è¿™ä¸ªæ§ä»¶æä¾›å¾ˆå¤§çš„å¸®åŠ©ã€‚

å…³äºæ‰§è¡Œå…ˆåé—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ [https://www.jianshu.com/p/4a62c10a36f1](https://www.jianshu.com/p/4a62c10a36f1)

è¿™ç¯‡æ–‡ç« è¯¦ç»†çš„è®²è¿°äº† APP çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä»¥åŠ`UIViewController`å’Œ`UIView`çš„ä¸€äº›é’©å­æ–¹æ³•çš„æ‰§è¡Œå…ˆåé¡ºåºã€‚ä½“ç°åœ¨`MJRefresh`ä¸­ï¼Œæ˜¯è¿™æ ·çš„ï¼š

```
alloc(prepare) -> setState -> willMoveToSuperView -> layoutSubViews(placeSubviews) -> drawRect
```

å…¶ä¸­ï¼Œ`prepare`  `setState ` `placeSubviews ` æ˜¯å­ç±»ä¼šå¤å†™çš„ï¼Œè¿™äº›æ–¹æ³•å­ç±»å®ç°æ—¶éƒ½ä¼šè°ƒç”¨`super`æ¥ç»§æ‰¿çˆ¶ç±»çš„å®ç°ï¼Œæ‰€ä»¥è¿™é‡Œé¢çš„å…³é”®æ˜¯è¦æ¸…æ™°æ¯ä¸€ä¸ªå­ç±»è¯¥å¹²çš„äº‹æƒ…ï¼Œæ›´æŠ½è±¡çš„è¡Œä¸ºåº”è¯¥å‡ºç°åœ¨æ›´é¡¶å±‚çš„ç±»çš„å®ç°ä¸­ï¼Œåä¹‹å°±è¶Šåº”è¯¥å‡ºç°åœ¨è¾ƒä½å±‚çš„å­ç±»ä¸­ã€‚

è€Œ`willMoveToSuperView` `drawRect `åˆ™å¹¶æ²¡æœ‰æ˜ç¡®çš„è¯´æ˜å­ç±»è¦å»å¤å†™ï¼Œä¸»è¦çš„ä»£ç è¿˜æ˜¯åœ¨`MJRefreshComponent`åŸºç±»ä¸­ã€‚å®ƒä»¬å¹¶ä¸æ˜¯ç‰¹åˆ«å…³é”®ï¼Œä½†ä¹Ÿæœ‰éœ€è¦å¤å†™çš„åŸå› ï¼Œä¸‹æ–‡ä¸­ä¼šè°ˆåˆ°ä»–ä»¬çš„ä½œç”¨ã€‚

æ¥ä¸‹æ¥æˆ‘æ‰“ç®—å°±è¿™å‡ ä¸ªå…³é”®çš„æ–¹æ³•æ¥åšä¸€ä¸‹åˆ†æï¼Œè€Œä¸å»è®²ç»“æ„å±‚æ¬¡å›¾äº†ï¼Œå› ä¸º`MJRefresh`çš„ç»“æ„å±‚æ¬¡è¿˜æ˜¯è›®å¤šçš„ï¼Œgithub ä¸Šä¹Ÿæœ‰ mj æœ¬äººç”»çš„å±‚æ¬¡å›¾ï¼Œæˆ‘æ²¡åŠæ³•é¡¾åŠå…¨å±€çš„å»è€ƒè™‘æ‰€æœ‰ç»†èŠ‚ï¼Œä½†ä¼šå°½å¯èƒ½çš„å…ˆå»ç†è§£è¿™å‡ ä¸ªå…³é”®æ–¹æ³•ä»¥åŠä¸‹æ‹‰åˆ·æ–°çš„æœºåˆ¶ï¼Œæ‰€ä»¥ä¸‹æ–‡æˆ‘ä¹Ÿåªä¼šå›´ç»• header çš„å‡ ä¸ªç±»æ¥è¿›è¡Œåˆ†æã€‚å³ï¼š

```
MJRefreshComponent -> MJRefreshHeader -> MJRefreshStateHeader -> MJRefreshNormalHeader
```

### prepare

æˆ‘ä»¬æŒ‰ç…§æ‰§è¡Œå…ˆåé¡ºåºæ¥çœ‹è¿™äº›æ–¹æ³•ï¼Œé¦–å…ˆå°±è¦çœ‹`prepare`äº†ã€‚åœ¨`prepare`æ–¹æ³•ä¸­ï¼Œ`MJRrefresh`ä¼šåšä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚

ä¿è¯åœ¨æ¨ªç«–å±åˆ‡æ¢çš„æ—¶å€™èƒ½å¤Ÿä¿è¯è‡ªèº«ç›¸å¯¹äºçˆ¶è§†å›¾çš„å·¦å³è¾¹è·ä¿æŒä¸å˜ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æ¯ä¸ªå­ç±»éƒ½å¿…é¡»çš„ï¼Œæ‰€ä»¥æ”¾åœ¨äº†åŸºç±»`MJRefreshComponent`ä¸­ã€‚

```
self.autoresizingMask = UIViewAutoresizingFlexibleWidth;
```

è®¾ç½®èƒŒæ™¯è‰²

```
self.backgroundColor = [UIColor clearColor];
```

è®¾ç½®keyï¼Œç”¨äº`NSUserDefaults`å­˜å‚¨æœ€ååˆ·æ–°æ—¶é—´

```
self.lastUpdatedTimeKey = MJRefreshHeaderLastUpdatedTimeKey;
```

è®¾ç½®è‡ªèº«é«˜åº¦ï¼Œå­ç±»çš„é«˜åº¦å¯èƒ½ä¸åŒï¼ˆheader å’Œ footer å°±ä¸ä¸€æ ·ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªæ“ä½œåº”è¯¥æ”¾åœ¨å­ç±»ä¸­å»è®¾ç½®ã€‚

```
self.mj_h = MJRefreshHeaderHeight;
```

`MJRefreshStateHeader`ä¸­å¼€å§‹å‡ºç°æ–‡å­—è®¾ç½®ï¼Œç”¨è¿™ä¸ªç±»ä»¥åŠå…¶å­ç±»å¯ä»¥å‡ºç°æ–‡å­—äº†ã€‚

```
// åˆå§‹åŒ–é—´è·
self.labelLeftInset = MJRefreshLabelLeftInset;
    
// åˆå§‹åŒ–æ–‡å­—
self setTitle:[NSBundle mj_localizedStringForKey:MJRefreshHeaderIdleText] forState:MJRefreshStateIdle];
[self setTitle:[NSBundle mj_localizedStringForKey:MJRefreshHeaderPullingText] forState:MJRefreshStatePulling];
[self setTitle:[NSBundle mj_localizedStringForKey:MJRefreshHeaderRefreshingText] forState:MJRefreshStateRefreshing];
```

`MJRefreshNormalHeader` æ˜¯æˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»åˆå¤šäº†ä¸€ä¸ªæ§ä»¶`UIActivityIndicatorView`ä»¥åŠä¼šæ—‹è½¬çš„ç®­å¤´ã€‚åœ¨è¿™ä¸ªç±»ä¸­ä¼šå»åˆå§‹åŒ–`UIActivityIndicatorView `çš„æ ·å¼ã€‚

```
self.activityIndicatorViewStyle = UIActivityIndicatorViewStyleGray;
```

### setState

å…ˆæ¥çœ‹åŸºç±»ä¸­çš„å®ç°ã€‚è¿™è¾¹å€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯`setNeedsLayout`æ–¹æ³•çš„å¤„ç†ã€‚MJ å‘Šè¯‰æˆ‘ä»¬è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†å…ˆæ‰§è¡Œå®Œæ•´ä¸ªç»§æ‰¿é“¾ä¸Šçš„`setState`ï¼Œç„¶åå†å»é‡æ–°å¸ƒå±€ã€‚è¿™é‡Œä¹‹æ‰€ä»¥è¦è°ƒç”¨`setNeedsLayout`å»è§¦å‘`layoutSubviews`æ˜¯å› ä¸ºæ–‡å­—çš„å˜åŒ–ä¼šå¼•èµ·å·¦ä¾§ç®­å¤´ä½ç½®çš„å˜åŒ–ï¼Œè¿™æ—¶å€™éœ€è¦åˆ·æ–°æ¥é‡åˆ¶ä½ç½®ã€‚

```
- (void)setState:(MJRefreshState)state
{
    _state = state;
    
    // åŠ å…¥ä¸»é˜Ÿåˆ—çš„ç›®çš„æ˜¯ç­‰setState:æ–¹æ³•è°ƒç”¨å®Œæ¯•ã€è®¾ç½®å®Œæ–‡å­—åå†å»å¸ƒå±€å­æ§ä»¶
    dispatch_async(dispatch_get_main_queue(), ^{
        [self setNeedsLayout];
    });
}
```

ç„¶åçœ‹çœ‹å­ç±»ä¸­çš„å®ç°ï¼š

è¿™é‡Œåšåˆ°äº‹æƒ… mj å·²ç»æ ‡æ³¨çš„å¾ˆæ¸…æ¥šäº†ï¼Œä¸å†è¿‡å¤šçš„è¯´æ˜ã€‚ä¸è€ƒè™‘ header ä¸­çš„å­è§†å›¾ï¼Œé‚£è¿™ä¸ªç©ºç™½çš„ header éœ€è¦å»å®Œæˆé‚£äº›äº‹æƒ…ï¼Œè¿™å—ä»£ç ç»™å‡ºäº†ç­”æ¡ˆã€‚

```
- (void)setState:(MJRefreshState)state
{
    MJRefreshCheckState
    
    // æ ¹æ®çŠ¶æ€åšäº‹æƒ…
    if (state == MJRefreshStateIdle) {
        if (oldState != MJRefreshStateRefreshing) return;
        
        // ä¿å­˜åˆ·æ–°æ—¶é—´
        [[NSUserDefaults standardUserDefaults] setObject:[NSDate date] forKey:self.lastUpdatedTimeKey];
        [[NSUserDefaults standardUserDefaults] synchronize];
        
        // æ¢å¤insetå’Œoffset
        [UIView animateWithDuration:MJRefreshSlowAnimationDuration animations:^{
            self.scrollView.mj_insetT += self.insetTDelta;
            
            // è‡ªåŠ¨è°ƒæ•´é€æ˜åº¦
            if (self.isAutomaticallyChangeAlpha) self.alpha = 0.0;
        } completion:^(BOOL finished) {
            self.pullingPercent = 0.0;
            
            if (self.endRefreshingCompletionBlock) {
                self.endRefreshingCompletionBlock();
            }
        }];
    } else if (state == MJRefreshStateRefreshing) {
         dispatch_async(dispatch_get_main_queue(), ^{
            [UIView animateWithDuration:MJRefreshFastAnimationDuration animations:^{
                CGFloat top = self.scrollViewOriginalInset.top + self.mj_h;
                // å¢åŠ æ»šåŠ¨åŒºåŸŸtop
                self.scrollView.mj_insetT = top;
                // è®¾ç½®æ»šåŠ¨ä½ç½®
                CGPoint offset = self.scrollView.contentOffset;
                offset.y = -top;
                [self.scrollView setContentOffset:offset animated:NO];
            } completion:^(BOOL finished) {
                [self executeRefreshingCallback];
            }];
         });
    }
}

```
è¿™é‡Œçš„è¯ä¸»è¦æ˜¯è®¾ç½®äº†æ–‡å­—ä»¥åŠå»è°ƒç”¨å±æ€§`lastUpdatedTimeKey`çš„ setter æ–¹æ³•ï¼Œè¿™é‡Œé¢ä¸å•å•æ˜¯è®¾ç½®äº†labelçš„æ–‡å­—ï¼Œè¿˜åšäº†ä¸€äº›å…¶ä»–çš„å¤„ç†ã€‚

```
- (void)setState:(MJRefreshState)state
{
    MJRefreshCheckState
    
    // è®¾ç½®çŠ¶æ€æ–‡å­—
    self.stateLabel.text = self.stateTitles[@(state)];
    
    // é‡æ–°è®¾ç½®keyï¼ˆé‡æ–°æ˜¾ç¤ºæ—¶é—´ï¼‰
    self.lastUpdatedTimeKey = self.lastUpdatedTimeKey;
}
```

è¿™é‡Œé¢ä¸»è¦å¤„ç†äº†ä¸€ä¸‹ç®­å¤´å’Œåœˆåœˆã€‚

```
- (void)setState:(MJRefreshState)state
{
    MJRefreshCheckState
    
    // æ ¹æ®çŠ¶æ€åšäº‹æƒ…
    if (state == MJRefreshStateIdle) {
        if (oldState == MJRefreshStateRefreshing) {
            self.arrowView.transform = CGAffineTransformIdentity;
            
            [UIView animateWithDuration:MJRefreshSlowAnimationDuration animations:^{
                self.loadingView.alpha = 0.0;
            } completion:^(BOOL finished) {
                // å¦‚æœæ‰§è¡Œå®ŒåŠ¨ç”»å‘ç°ä¸æ˜¯idleçŠ¶æ€ï¼Œå°±ç›´æ¥è¿”å›ï¼Œè¿›å…¥å…¶ä»–çŠ¶æ€
                if (self.state != MJRefreshStateIdle) return;
                
                self.loadingView.alpha = 1.0;
                [self.loadingView stopAnimating];
                self.arrowView.hidden = NO;
            }];
        } else {
            [self.loadingView stopAnimating];
            self.arrowView.hidden = NO;
            [UIView animateWithDuration:MJRefreshFastAnimationDuration animations:^{
                self.arrowView.transform = CGAffineTransformIdentity;
            }];
        }
    } else if (state == MJRefreshStatePulling) {
        [self.loadingView stopAnimating];
        self.arrowView.hidden = NO;
        [UIView animateWithDuration:MJRefreshFastAnimationDuration animations:^{
            self.arrowView.transform = CGAffineTransformMakeRotation(0.000001 - M_PI);
        }];
    } else if (state == MJRefreshStateRefreshing) {
        self.loadingView.alpha = 1.0; // é˜²æ­¢refreshing -> idleçš„åŠ¨ç”»å®Œæ¯•åŠ¨ä½œæ²¡æœ‰è¢«æ‰§è¡Œ
        [self.loadingView startAnimating];
        self.arrowView.hidden = YES;
    }
}
```

### willMoveToSuperview

ç°åœ¨æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•é‡Œåšäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿå®ƒä¼šå»åˆ¤æ–­çˆ¶è§†å›¾çš„ç±»å‹ï¼Œä¼šå»è®¾ç½®`mj_x` å’Œ `mj_w` ä¸¤ä¸ªå±æ€§ï¼Œè¿˜ä¼šè®°å½•`scrollView`çš„ä¸€äº›åŸºæœ¬çš„å±æ€§å€¼ã€‚

è¿™ä¸ªæ–¹æ³•åœ¨`UIView`çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æ˜¯ä¼šè°ƒç”¨ä¸¤æ¬¡çš„ï¼Œä¸€æ¬¡æ˜¯å­è§†å›¾å³å°†æ·»åŠ åˆ°çˆ¶è§†å›¾ä¸Šçš„æ—¶å€™ï¼Œè¿˜æœ‰ä¸€æ¬¡æ˜¯å­è§†å›¾å³å°†ä»çˆ¶è§†å›¾ç§»é™¤çš„æ—¶å€™ã€‚å¯èƒ½æœ‰çš„å°ä¼™ä¼´ä¼šå¯¹è¿™ä¸ªåœ°æ–¹äº§ç”Ÿç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆè¦æŠŠè¿™äº›åˆå§‹åŒ–æ“ä½œæ”¾åœ¨è¿™ä¸ªé‡Œé¢ï¼Ÿä¸èƒ½ç›´æ¥æ”¾åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­å—ï¼Ÿå…¶å®åªè¦æƒ³ä¸€ä¸‹`MJRerfesh`çš„æœåŠ¡å¯¹è±¡å°±çŸ¥é“äº†ğŸ˜Œï¼Œè¿™é‡Œæ˜¯åˆ¤æ–­çˆ¶è§†å›¾æ˜¯ä¸æ˜¯`scrollView`ä»¥åŠå…¶å­ç±»çš„æœ€ä½³ä½ç½®,æ”¾åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­æ²¡æ³•åˆ¤æ–­çˆ¶è§†å›¾ï¼Œæ”¾åœ¨`layoutSubViews`ä¸­åˆ™å¤ªæ™šäº†ï¼Œè€Œä¸”ä¼šè°ƒç”¨å¤šæ¬¡ã€‚

```
- (void)willMoveToSuperview:(UIView *)newSuperview
{
    [super willMoveToSuperview:newSuperview];
    
    // å¦‚æœä¸æ˜¯UIScrollViewï¼Œä¸åšä»»ä½•äº‹æƒ…
    if (newSuperview && ![newSuperview isKindOfClass:[UIScrollView class]]) return;
    
    // æ—§çš„çˆ¶æ§ä»¶ç§»é™¤ç›‘å¬
    [self removeObservers];
    
    if (newSuperview) { // æ–°çš„çˆ¶æ§ä»¶
        // è®¾ç½®å®½åº¦
        self.mj_w = newSuperview.mj_w;
        // è®¾ç½®ä½ç½®
        self.mj_x = -_scrollView.mj_insetL;
        
        // è®°å½•UIScrollView
        _scrollView = (UIScrollView *)newSuperview;
        // è®¾ç½®æ°¸è¿œæ”¯æŒå‚ç›´å¼¹ç°§æ•ˆæœ
        _scrollView.alwaysBounceVertical = YES;
        // è®°å½•UIScrollViewæœ€å¼€å§‹çš„contentInset
        _scrollViewOriginalInset = _scrollView.mj_inset;
        
        // æ·»åŠ ç›‘å¬
        [self addObservers];
    }
}
```

åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œè¿˜ä¼šå»è®¾ç½®å¯¹`scrollView`ä¸€äº›å±æ€§çš„ç›‘å¬ï¼Œåˆ°è¿™ä¸çœ‹å…·ä½“çš„ä»£ç ä¹Ÿèƒ½çŒœå¾—åˆ°ç»å¯¹è¦ç›‘å¬çš„é‚£ä¸ªå±æ€§äº†ï¼š`scrollView`çš„`contentOffset`ã€‚è¿™ä¹Ÿæ˜¯`MJRefresh`ä¸‹æ‹‰åˆ·æ–°å‘æŒ¥ä½œç”¨çš„çœŸæ­£å…³é”®ç®—åœ¨ã€‚æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹ï¼Œ`MJRefresh`æ˜¯å¦‚ä½•é’ˆå¯¹è¯¥å€¼çš„å˜åŒ–ä½œå‡ºå“åº”è°ƒæ•´çš„ã€‚

è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯åœ¨`MJRefreshComponent`ä¸­å®ç°çš„ï¼Œé‚£å‡ ä¸ª header å­ç±»éƒ½æ²¡æœ‰å®ç°ï¼Œä½†å…¶å® footer æ˜¯è¿›è¡Œäº†å¤å†™çš„ï¼Œè¿™ä¸ªæˆ‘ä»¬å…ˆä¸åšè®¨è®ºäº†ï¼Œä½†æœ‰ä¸€ç‚¹æ˜¯æ˜ç¡®çš„ï¼Œä¸åŒå±‚çº§çš„ç±»åšä¸åŒçš„äº‹æƒ…ï¼Œä¸å»åšè¶…å‡ºè‡ªèº«èŒè´£èŒƒå›´çš„äº‹æƒ…ã€‚


### placeSubViews

è¿™ä¸ªæ–¹æ³•åœ¨åŸºç±»ä¸­å¹¶æ²¡æœ‰åšä»€ä¹ˆï¼Œå› ä¸ºåŸºç±»ä¸­æ²¡æœ‰å­è§†å›¾ğŸ˜‚

ç”±äºåœ¨`prepare`ä¸­åˆå§‹åŒ–äº†`MJRefresh`çš„é«˜åº¦ï¼Œæ‰€ä»¥éœ€è¦æ”¹å˜è‡ªèº«çš„å‚ç›´ä½ç½®ï¼Œåœ¨è¿™é‡Œï¼Œå°±å¯ä»¥çœ‹å‡ºå±æ€§`ignoredScrollViewContentInsetTop`çš„ä½œç”¨ï¼Œä»–å¯ä»¥å†³å®š`MJRefresh`çš„å‚ç›´ä½ç½®ï¼Œä»è€Œæ”¹å˜æ»‘åŠ¨`scrollview`è¾¾åˆ°ä¸´ç•Œåˆ·æ–°ç‚¹æ‰€éœ€è¦çš„è·ç¦»ã€‚

```
self.mj_y = - self.mj_h - self.ignoredScrollViewContentInsetTop;
```

`MJRefreshStateHeader`ä¸­å¼€å§‹å‡ºç°å­è§†å›¾ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šå¸ƒå±€å­è§†å›¾ã€‚è¿™é‡Œå‡ºç°äº†ä¸¤ä¸ªå­è§†å›¾ï¼š`stateLabel` å’Œ `lastUpdatedTimeLabel`ï¼Œåˆ†åˆ«ä»£è¡¨äº†æ˜¾ç¤ºåˆ·æ–°çŠ¶æ€å’Œæ˜¾ç¤ºä¸Šä¸€æ¬¡åˆ·æ–°æ—¶é—´çš„`Label`ã€‚ä¸‹é¢çš„ä»£ç ä¸»è¦æ˜¯å¯¹å…¶è¿›è¡Œå¸ƒå±€ã€‚å¦‚æœçœ‹äº†è¿™ä¸¤ä¸ªå­è§†å›¾çš„æ‡’åŠ è½½æ–¹æ³•ï¼Œä½ ä¼šå‘ç°å®ƒä»¬ä¹Ÿè®¾ç½®äº†`autoresizingMask`,åŒæ ·æ˜¯ä¸ºäº†åº”å¯¹æ¨ªç«–å±åˆ‡æ¢ã€‚

```
if (self.stateLabel.hidden) return;

BOOL noConstrainsOnStatusLabel = self.stateLabel.constraints.count == 0;

if (self.lastUpdatedTimeLabel.hidden) {
    // çŠ¶æ€
    if (noConstrainsOnStatusLabel) self.stateLabel.frame = self.bounds;
} else {
    CGFloat stateLabelH = self.mj_h * 0.5;
    // çŠ¶æ€
    if (noConstrainsOnStatusLabel) {
       self.stateLabel.mj_x = 0;
       self.stateLabel.mj_y = 0;
       self.stateLabel.mj_w = self.mj_w;
       self.stateLabel.mj_h = stateLabelH;
    }
    
    // æ›´æ–°æ—¶é—´
    if (self.lastUpdatedTimeLabel.constraints.count == 0) {
        self.lastUpdatedTimeLabel.mj_x = 0;
        self.lastUpdatedTimeLabel.mj_y = stateLabelH;
        self.lastUpdatedTimeLabel.mj_w = self.mj_w;
        self.lastUpdatedTimeLabel.mj_h = self.mj_h - self.lastUpdatedTimeLabel.mj_y;
    }     
} 
```

è¿™é‡Œä¼šè°ƒæ•´ç®­å¤´å’Œåœˆåœˆçš„ä½ç½®

```
- (void)placeSubviews
{
    [super placeSubviews];
    
    // ç®­å¤´çš„ä¸­å¿ƒç‚¹
    CGFloat arrowCenterX = self.mj_w * 0.5;
    if (!self.stateLabel.hidden) {
        CGFloat stateWidth = self.stateLabel.mj_textWith;
        CGFloat timeWidth = 0.0;
        if (!self.lastUpdatedTimeLabel.hidden) {
            timeWidth = self.lastUpdatedTimeLabel.mj_textWith;
        }
        CGFloat textWidth = MAX(stateWidth, timeWidth);
        arrowCenterX -= textWidth / 2 + self.labelLeftInset;
    }
    CGFloat arrowCenterY = self.mj_h * 0.5;
    CGPoint arrowCenter = CGPointMake(arrowCenterX, arrowCenterY);
    
    // ç®­å¤´
    if (self.arrowView.constraints.count == 0) {
        self.arrowView.mj_size = self.arrowView.image.size;
        self.arrowView.center = arrowCenter;
    }
        
    // åœˆåœˆ
    if (self.loadingView.constraints.count == 0) {
        self.loadingView.center = arrowCenter;
    }
    
    self.arrowView.tintColor = self.stateLabel.textColor;
}
```

å›è¿‡å¤´æ¥ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆ`mj_x` `mj_y` `mj_w` `mj_h` è¿™å››ä¸ªå±æ€§çš„è®¾ç½®åœ°æ–¹æ˜¯ä¸åŒçš„?

`mj_x` `mj_w` çš„è®¾ç½®å‡ºç°åœ¨äº†`MJRefreshComponent`çš„`willMoveToSuperView`æ–¹æ³•ä¸­ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå€¼å§‹ç»ˆæ˜¯ä¸ä¼šå»å˜çš„ã€‚è™½ç„¶å¯èƒ½ä¼šæ¨ªç«–å±åˆ‡æ¢ï¼Œä½†æ˜¯`autoresizingMask`çš„è®¾ç½®å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œ`MJRefresh`çš„æ°´å¹³æ–¹å‘çš„å¸ƒå±€å§‹ç»ˆæ˜¯å®šä¸‹æ¥äº†ã€‚

è€Œ`mj_h ` `mj_y` è¿™ä¸¤ä¸ªå€¼çš„è®¾ç½®åˆ†åˆ«åœ¨`MJRefreshHeader`çš„`prepare`å’Œ`placeSubviews`æ–¹æ³•ä¸­ï¼Œå‰è€…æ˜¯å› ä¸º`header`å’Œ`footer`çš„é«˜åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œåè€…æ˜¯å› ä¸º`mj_h`çš„å€¼å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼ŒMJ æœ¬äººæ ‡æ³¨çš„æ³¨é‡Šè¡¨ç¤ºï¼š

"å½“è‡ªå·±çš„é«˜åº¦å‘ç”Ÿæ”¹å˜äº†ï¼Œè‚¯å®šè¦é‡æ–°è°ƒæ•´Yå€¼ï¼Œæ‰€ä»¥æ”¾åˆ°placeSubviewsæ–¹æ³•ä¸­è®¾ç½®yå€¼"

### scrollViewContentOffsetDidChange

é¦–å…ˆæˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹ï¼Œæœ‰å“ªäº›æƒ…å†µä¼šå¼•èµ·`contentOffset`çš„å˜åŒ–ï¼Ÿæ— éæ˜¯è¿™å‡ ç§

1. æ‰‹æŒ‡è¿›è¡Œæ‹‰æ‹½çš„æ—¶å€™
2. æ‰‹æŒ‡ä¸‹æ‹‰åˆ°ä¸€å®šç¨‹åº¦æ¾å¼€åçš„å›æ»šçŠ¶æ€æ—¶
3. æ‰‹æŒ‡æ¾å¼€åçš„æƒ¯æ€§æ»šåŠ¨
4. è°ƒç”¨`setContentOffSet`å¼•èµ·çš„æ»šåŠ¨

è¿™ä¸ªæ–¹æ³•é¦–å…ˆä¼šå»çœ‹æœ¬èº«æ˜¯å¦æ˜¯åœ¨åˆ·æ–°çŠ¶æ€ä¸­ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£è‚¯å®šä¸ä¼šå»æ”¹å˜å®ƒçš„`state`çŠ¶æ€ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå°±è¦åˆ†æƒ…å†µè€ƒè™‘äº†ï¼Œå¦‚æœæ‰‹æŒ‡æ­£åœ¨æ‹–æ‹½ä¸­ï¼Œé‚£ä¹ˆå°±è¦æ ¹æ®æ˜¯å¦è¶…è¿‡ä¸´ç•Œå€¼è€Œå†³å®šæ˜¯å¦å°†çŠ¶æ€æ›´æ”¹ä¸º`pulling`çŠ¶æ€ï¼Œä¸€æ—¦æ¾æ‰‹ï¼Œ`scrollView`å›å¼¹æ»šåŠ¨ï¼Œè¿™æ—¶å€™å·²ç»æ ‡è®°ä¸º`pulling`çŠ¶æ€ï¼Œæ‰€ä»¥å°±è¦ç›´æ¥è°ƒç”¨`beginRefresh`æ–¹æ³•äº†ã€‚ä¸è¿‡æ”¾æ‰‹çš„æ—¶å€™ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰è¶…è¿‡ä¸´ç•Œå€¼ï¼Œè¿™æ—¶å€™ä¸ä¼šè°ƒç”¨`beginRefresh `ï¼Œè€Œæ˜¯ä¼šå»æ ‡è®°å®ƒçš„`pullingPercent`ï¼Œä»è€Œè°ƒæ•´å®ƒçš„`alpha`å€¼ã€‚è¿™é‡Œä¸“é—¨åšäº†ä¸€ä¸ªæ¸å˜çš„æ•ˆæœï¼Œéå¸¸æœ‰å¿ƒï¼Œèµä¸€ä¸ªã€‚


```
- (void)scrollViewContentOffsetDidChange:(NSDictionary *)change
{
    [super scrollViewContentOffsetDidChange:change];
    
    // åœ¨åˆ·æ–°çš„refreshingçŠ¶æ€
    if (self.state == MJRefreshStateRefreshing) {
        // æš‚æ—¶ä¿ç•™
        if (self.window == nil) return;
        
        // sectionheaderåœç•™è§£å†³
        CGFloat insetT = - self.scrollView.mj_offsetY > _scrollViewOriginalInset.top ? - self.scrollView.mj_offsetY : _scrollViewOriginalInset.top;
        insetT = insetT > self.mj_h + _scrollViewOriginalInset.top ? self.mj_h + _scrollViewOriginalInset.top : insetT;
        self.scrollView.mj_insetT = insetT;
        
        self.insetTDelta = _scrollViewOriginalInset.top - insetT;
        return;
    }
    
    // è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæ§åˆ¶å™¨æ—¶ï¼ŒcontentInsetå¯èƒ½ä¼šå˜
     _scrollViewOriginalInset = self.scrollView.mj_inset;
    
    // å½“å‰çš„contentOffset
    CGFloat offsetY = self.scrollView.mj_offsetY;
    // å¤´éƒ¨æ§ä»¶åˆšå¥½å‡ºç°çš„offsetY
    CGFloat happenOffsetY = - self.scrollViewOriginalInset.top;
    
    // å¦‚æœæ˜¯å‘ä¸Šæ»šåŠ¨åˆ°çœ‹ä¸è§å¤´éƒ¨æ§ä»¶ï¼Œç›´æ¥è¿”å›
    // >= -> >
    if (offsetY > happenOffsetY) return;
    
    // æ™®é€š å’Œ å³å°†åˆ·æ–° çš„ä¸´ç•Œç‚¹
    CGFloat normal2pullingOffsetY = happenOffsetY - self.mj_h;
    CGFloat pullingPercent = (happenOffsetY - offsetY) / self.mj_h;
    
    if (self.scrollView.isDragging) { // å¦‚æœæ­£åœ¨æ‹–æ‹½
        self.pullingPercent = pullingPercent;
        if (self.state == MJRefreshStateIdle && offsetY < normal2pullingOffsetY) {
            // è½¬ä¸ºå³å°†åˆ·æ–°çŠ¶æ€
            self.state = MJRefreshStatePulling;
        } else if (self.state == MJRefreshStatePulling && offsetY >= normal2pullingOffsetY) {
            // è½¬ä¸ºæ™®é€šçŠ¶æ€
            self.state = MJRefreshStateIdle;
        }
    } else if (self.state == MJRefreshStatePulling) {// å³å°†åˆ·æ–° && æ‰‹æ¾å¼€
        // å¼€å§‹åˆ·æ–°
        [self beginRefreshing];
    } else if (pullingPercent < 1) {
        self.pullingPercent = pullingPercent;
    }
}

```

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹`beginRefreshing`æ–¹æ³•åšäº†ä»€ä¹ˆï¼Ÿä»–å…¶å®ä¸»è¦å°±æ˜¯æŠŠ`state`æ ‡è®°ä¸º`MJRefreshStateRefreshing`ã€‚ä½†æ˜¯å®ƒè¿˜åšäº†å¦å¤–ä¸€å±‚åˆ¤æ–­ï¼š`window`çš„æœ‰æ— ã€‚MJ ä¹Ÿåšäº†å¤‡æ³¨ï¼Œè¯´æ˜äº†ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªåˆ¤æ–­ï¼Œä¸»è¦æ˜¯å› ä¸ºé¢„é˜²ç”¨æˆ·è¿‡æ—©çš„è°ƒç”¨äº†`beginRefresh`æ–¹æ³•ï¼Œç„¶è€Œè¿™æ—¶å€™è‡ªèº«è¿˜å¹¶æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥å·§å¦™çš„å…ˆå°†`state`æ ‡è®°ä¸ºäº†`MJRefreshStateWillRefresh`ã€‚


```
- (void)beginRefreshing
{
    [UIView animateWithDuration:MJRefreshFastAnimationDuration animations:^{
        self.alpha = 1.0;
    }];
    self.pullingPercent = 1.0;
    // åªè¦æ­£åœ¨åˆ·æ–°ï¼Œå°±å®Œå…¨æ˜¾ç¤º
    if (self.window) {
        self.state = MJRefreshStateRefreshing;
    } else {
        // é¢„é˜²æ­£åœ¨åˆ·æ–°ä¸­æ—¶ï¼Œè°ƒç”¨æœ¬æ–¹æ³•ä½¿å¾—header insetå›ç½®å¤±è´¥
        if (self.state != MJRefreshStateRefreshing) {
            self.state = MJRefreshStateWillRefresh;
            // åˆ·æ–°(é¢„é˜²ä»å¦ä¸€ä¸ªæ§åˆ¶å™¨å›åˆ°è¿™ä¸ªæ§åˆ¶å™¨çš„æƒ…å†µï¼Œå›æ¥è¦é‡æ–°åˆ·æ–°ä¸€ä¸‹)
            [self setNeedsDisplay];
        }
    }
}

```


åˆ°åº•è¿™ä¸ªæ ‡è®°ä¼šæœ‰ä»€ä¹ˆæ ·çš„å½±å“ï¼Ÿè¿™æ—¶å€™å°±è¦å»å¦å¤–ä¸€ä¸ªæ–¹æ³•é‡Œçœ‹äº†ï¼š`drawRect`ï¼Œç”±ä¸Šæ–‡æ‰€è¯´çš„è°ƒç”¨é¡ºåºå¯çŸ¥ï¼Œ`drawRect`æ˜¯åœ¨æœ€åæ‰å›å»è°ƒç”¨çš„ï¼Œæ­¤æ—¶è§†å›¾å·²ç»è¢«æ·»åŠ åˆ°çˆ¶è§†å›¾äº†ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå»¶ç¼“äº†`MJRefresh`çš„åˆ·æ–°æ—¶é—´ï¼Œä»è€Œä¿è¯äº†çˆ¶è§†å›¾çš„å­˜åœ¨ã€‚

```
- (void)drawRect:(CGRect)rect
{
    [super drawRect:rect];
    
    if (self.state == MJRefreshStateWillRefresh) {
        // é¢„é˜²viewè¿˜æ²¡æ˜¾ç¤ºå‡ºæ¥å°±è°ƒç”¨äº†beginRefreshing
        self.state = MJRefreshStateRefreshing;
    }
}
```

### å°ç»“

å…¶å®å†™ç€å†™ç€ï¼Œå‘ç°`MJRefresh`ä¸­çš„ä¸œè¥¿æ¯”æˆ‘æƒ³è±¡çš„è¿˜è¦å¤šï¼Œå¦‚æœè¦æŠ“ç»†èŠ‚æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½ç†æ¸…ï¼Œä¼°è®¡è¦å†™ä¸ªå‡ ç¯‡æ–‡ç« ã€‚è¿™æ¬¡çš„æºä»£ç é˜…è¯»ç»å†å¸¦ç»™æˆ‘çš„æ”¶è·ä¸»è¦æ˜¯å¦‚ä½•è¿›è¡Œå±‚çº§è®¾è®¡ä»¥åŠç†è§£`UIView`ç”Ÿå‘½å‘¨æœŸæˆ–è€…è¯´æ˜¯é‚£å‡ ä¸ªæ–¹æ³•çš„è°ƒç”¨é¡ºåºã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæŠŠä»£ç ä¸€è‚¡è„‘çš„æ”¾åœ¨æŸä¸€ä¸ªæ–¹æ³•é‡Œï¼Œè¿™æ ·æ—¢æ²¡æ³•æé«˜å¯è¯»æ€§ï¼Œå¾€å¾€è¿˜ä¼šå‡ºç°ä¸€äº›å¾ˆéš¾å‘ç°çš„é”™è¯¯ã€‚å¦‚æœèƒ½å¤ŸæŠŠè¿™äº›ä»£ç æ‰“æ•£åœ¨ä¸åŒçš„å±‚çº§ä¸­ï¼Œä¸åŒçš„é’©å­æ–¹æ³•ä¸­ï¼Œè¿™æ ·åœ¨å†™é‚£äº›ç‰¹åˆ«å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ—¶æ€è·¯èƒ½å¤Ÿæ›´æ¸…æ™°è€Œå°‘çŠ¯é”™ã€‚

`MJRefresh`ä¹Ÿä¸ä¹ä¸€äº›è€äººå¯»å‘³çš„å°çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚è¯´`__unsafe_unretained`çš„ä½¿ç”¨ã€‚`__unsafe_unretained`æ‰€ä¿®é¥°çš„æŒ‡é’ˆåœ¨æ‰€æŒ‡å‘å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œä¸ä¼šç½®ä¸º`nil`ã€‚ åœ¨`MJRefresh`ä¸­ï¼Œæ‰€æœ‰çš„å­è§†å›¾éƒ½æ˜¯ç”¨è¿™ç§å½¢å¼å»ä¿®é¥°çš„ï¼Œå› ä¸ºå­è§†å›¾å’Œçˆ¶è§†å›¾çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥åœ¨å­è§†å›¾é”€æ¯çš„æ—¶å€™ï¼ŒæŒ‡å‘è¯¥å­è§†å›¾çš„æŒ‡é’ˆæ²¡å¿…è¦å†å»ç½®ä¸º`nil`äº†ï¼Œå­è§†å›¾é”€æ¯åçˆ¶è§†å›¾ä¹Ÿä¼šé”€æ¯ï¼Œå†…å­˜å›æ”¶ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°ä»€ä¹ˆé‡æŒ‡é’ˆçš„æƒ…å†µäº†ã€‚

è¿™æ¬¡çš„æºä»£ç æ¢ç´¢åªæ˜¯å¼€å§‹ï¼Œä»¥åæˆ‘è¿˜ä¼šå†å›æ¥çœ‹`MJRefresh`ï¼Œæˆ‘ä¹Ÿä¼šå»ç ”ç©¶å…¶ä»–çš„å¼€æºé¡¹ç›®ï¼Œé›†æ€å¹¿ç›Šã€‚æ­£å¦‚ç‰›é¡¿æ‰€è¯´ï¼Œä¹‹æ‰€ä»¥èƒ½å–å¾—å¦‚æ­¤æˆå°±ï¼Œå°±æ˜¯å› ä¸ºç«™åœ¨äº†å·¨äººçš„è‚©è†€ä¸Šã€‚